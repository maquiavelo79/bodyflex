CALL SP_CAT_CSU_COL_POR(@codErr);
SELECT @codErr;

-- SELECT * FROM COLECCION
-- SELECT * FROM PARAMETROS

DROP PROCEDURE IF EXISTS bodyflex.SP_CAT_CSU_COL_POR;
CREATE PROCEDURE bodyflex.`SP_CAT_CSU_COL_POR`(OUT codErr INTEGER)
BEGIN
  -- CONSULTA IMAGENES COLECCION PARA PORTADA DE CATALOGO
  -- DECLARE EXIT HANDLER FOR SQLEXCEPTION SET codErr=99;
  
  SET @GD=(SELECT PARVAL FROM PARAMETROS WHERE PARNOM='DRIVE');
  SET @LC=(SELECT PARVAL FROM PARAMETROS WHERE PARNOM='LIMIT_COL');
  
  IF EXISTS(
      SELECT * 
      FROM COLECCION C, COLECCION_PRODUCTO CP 
      WHERE C.COID=CP.COID
    ) THEN
      
    SELECT C.COID
    , REPLACE(@GD, 'FILEID', coGD3) AS URL3
    , C.coNo as NOM
    , REPLACE(@GD, 'FILEID', coGD4) AS URL4
    , C.coEnMenu 
    , @LC AS LIMIT_COL
    FROM COLECCION C
    LEFT JOIN COLECCION_PRODUCTO CP
    ON C.COID=CP.COID 
    GROUP BY URL3
    ORDER BY RAND(); 
    -- ORDER BY RAND()LIMIT 4; 
    
  ELSE
    SET codErr=98;  
  END IF;
 
END

  



-- SELECT * FROM COLECCION C, COLECCION_PRODUCTO CP WHERE C.COID=CP.COID;
-- SELECT * FROM COLECCION
-- SELECT * FROM COLECCION_PRODUCTO

